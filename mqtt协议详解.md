
# mqtt协议详解(代码示例)

## connect - 连接服务器 1

>  固定头(2B-5B): 
>  
>  命令标志1B + 剩余总长度1-4B(可变头+负载)

    `10 + 剩余总长度1B`
   
>  可变头(共10B)：   
>  长度2B + MQTT + 协议版本1B + 连接标志1B + 保持连接时间2B
    
    `00 04 ‘M’‘Q’‘T’‘T’ 04 C2 00 FF`
    
    `00 04 4D 51 54 54 04 C2 00 FF` 保留
    
    `00 04 4D 51 54 54 04 C0 00 FF` 不保留
    


>  负载(长度是高字节在前低字节在后 比如: 00 08)
>  
>  长度(2B) + 客户端ID + 长度(2B) + 用户名 + 长度(2B) + 密码
    
## 应答成功 2

   `20 02 01 00` 保留

   `20 02 00 00` 不保留
    
## 发布消息 3


>  Qos:0 DUP一直为0 不使用保留 0 没有报文标志符
>  
>  30 + 剩余总长度1B + 主题长度 + 主题 + 内容 + Qos等级1B
    

## 







## subscribe 订阅 8


>   82 + 剩余总长度1B + 消息编号2B + 长度2B + 内容nB + Qos等级1B
>   
>   (消息编号的订阅与应答是一一对应的, 下同)
  
  `82 0E 00 0A 00 09 61 70 70 5F 74 6F 70 69 63 00` 等级0
  
  `82 0E 00 0A 00 09 61 70 70 5F 74 6F 70 69 63 01` 等级1

## subscribe 回复 9

>   90 + 剩余总长度1B + 消息编号2B + Qos等级1B
    
   `90 03 00 0A 00` 等级0
   
   `90 03 00 0A 01` 等级1

## 取消订阅 10
 
>   A2 + 剩余总长度1B + 消息编号2B + 长度2B + 内容nB
   
   `A2 0D 00 0A 00 09 61 70 70 5F 74 6F 70 69 63`
    
## 取消订阅 回复 11
   
> B0 + 剩余总长度1B + 消息编号2B
   
   `B0 02 00 0A`

## ping 保活 12
   `C0 00`

## ping 应答 13
   `D0 00`

## disconnect 断开连接 14
   `E0 00`
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 